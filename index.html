<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #dddddd;
    }

    .card {
      height: 100%;
    }

    .chart-container {
      width: 100%;
      height: 50%;
    }
    .reset-button {
    position: fixed;
    top: 15px;
    right: 15px;
    z-index: 1000;
  }
  </style>
  
  
<script>
    let chart1, chart2;

function onClientLoad() {
  gapi.load('client', initClient);
}

function initClient() {
  gapi.client.init({
    apiKey: 'AIzaSyB2E9qxwpsLkA9CGm-5U65bselwI77dLBA',
    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest']
  }).then(() => {
    document.getElementById('video-form').addEventListener('submit', function(event) {
      event.preventDefault();

      const videoId1 = document.getElementById('video-id-1').value;
      const videoId2 = document.getElementById('video-id-2').value;

      if (videoId1 && videoId2) {
        compareLiveStreams(videoId1, videoId2);
        this.classList.add('d-none');
        document.getElementById('reset-btn').classList.remove('d-none');
      }
    });
  }).catch(error => console.error('Error initializing YouTube Data API:', error));
}

function createPieChart(context, label1, label2) {
  return new Chart(context, {
    type: 'pie',
    data: {
      labels: [label1, label2],
      datasets: [{
        data: [50, 50],
        backgroundColor: ['#007bff', '#cccccc'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });
}


function resetComparison() {
  clearInterval(updateInterval);
  document.getElementById('video-form').classList.remove('d-none');
  document.getElementById('reset-btn').classList.add('d-none');
  document.getElementById('video-title-1').innerText = 'Video 1 Title';
  document.getElementById('video-title-2').innerText = 'Video 2 Title';
  document.getElementById('video-views-1').innerText = '0';
  document.getElementById('video-views-2').innerText = '0';
  document.getElementById('video-percentage-1').innerText = '0';
  document.getElementById('video-percentage-2').innerText = '0';
  chart1.destroy();
  chart2.destroy();
  chart1 = null;
  chart2 = null;
}

let updateInterval;

function updatePieChart(chart, percentage1, percentage2) {
  chart.data.datasets[0].data = [percentage1, percentage2];
  chart.update();
}


function compareLiveStreams(videoId1, videoId2) {
  updateInterval = setInterval(() => {
    gapi.client.youtube.videos.list({
      id: `${videoId1},${videoId2}`,
      part: 'liveStreamingDetails,snippet,statistics'
    }).then(response => {
      const videos = response.result.items;

      const video1 = videos.find(video => video.id === videoId1);
      const video2 = videos.find(video => video.id === videoId2);

      const views1 = parseInt(video1.statistics.viewCount, 10);
      const views2 = parseInt(video2.statistics.viewCount, 10);
      const concurrentViewers1 = parseInt(video1.liveStreamingDetails.concurrentViewers, 10) || 0;
      const concurrentViewers2 = parseInt(video2.liveStreamingDetails.concurrentViewers, 10) || 0;

      const totalConcurrentViewers = concurrentViewers1 + concurrentViewers2;
      const livePercentage1 = ((concurrentViewers1 / totalConcurrentViewers) * 100).toFixed(2);
      const livePercentage2 = ((concurrentViewers2 / totalConcurrentViewers) * 100).toFixed(2);

      document.getElementById('video-title-1').innerText = video1.snippet.title;
      document.getElementById('video-title-2').innerText = video2.snippet.title;
      document.getElementById('video-views-1').innerText = views1.toLocaleString();
      document.getElementById('video-views-2').innerText = views2.toLocaleString();
      document.getElementById('video-concurrent-viewers-1').innerText = concurrentViewers1.toLocaleString();
      document.getElementById('video-concurrent-viewers-2').innerText = concurrentViewers2.toLocaleString();
      document.getElementById('video-percentage-1').innerText = livePercentage1;
      document.getElementById('video-percentage-2').innerText = livePercentage2;

      if (!chart1) {
        const ctx1 = document.getElementById('video-chart-1').getContext('2d');
        chart1 = createPieChart(ctx1, video1.snippet.title, video2.snippet.title);
      }
      if (!chart2) {
        const ctx2 = document.getElementById('video-chart-2').getContext('2d');
        chart2 = createPieChart(ctx2, video2.snippet.title, video1.snippet.title);
      }

      updatePieChart(chart1, livePercentage1, livePercentage2);
updatePieChart(chart2, livePercentage2, livePercentage1);

    }).catch(error => console.error('Error getting video data:', error));
  }, 10000);
}



  </script>
  
</head>
<body onload="onClientLoad()">
    <div class="container">
        <button id="reset-btn" class="btn btn-outline-danger reset-button d-none" onclick="resetComparison()">Reset</button>
      <h1 class="text-center my-5">YouTube Live Stream View Comparison</h1>
      <form id="video-form" class="mb-4">
        <div class="row">
          <div class="col-md-6">
            <label for="video-id-1">Stream 1 Video ID:</label>
            <input type="text" class="form-control" id="video-id-1" required>
          </div>
          <div class="col-md-6">
            <label for="video-id-2">Stream 2 Video ID:</label>
            <input type="text" class="form-control" id="video-id-2" required>
          </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3">Compare Streams</button>
      </form>
      <div class="row">
        <div class="col-md-6">
          <div class="card rounded shadow">
            <div class="card-body d-flex flex-column">
              <h4 class="card-title" id="video-title-1">Video 1 Title</h4>
              <p class="card-text d-none">Views: <span id="video-views-1">0</span></p>
              <p class="card-text">Live Viewers: <span id="video-concurrent-viewers-1">0</span></p>
              <p class="card-text">Percentage: <span id="video-percentage-1">0</span>%</p>
              <div class="chart-container mt-auto">
                <canvas id="video-chart-1"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card rounded shadow">
            <div class="card-body d-flex flex-column">
              <h4 class="card-title" id="video-title-2">Video 2 Title</h4>
              <p class="card-text d-none">Views: <span id="video-views-2">0</span></p>
              <p class="card-text">Live Viewers: <span id="video-concurrent-viewers-2">0</span></p>
              <p class="card-text">Percentage: <span id="video-percentage-2">0</span>%</p>
              <div class="chart-container mt-auto">
                <canvas id="video-chart-2"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  
</html>

  
