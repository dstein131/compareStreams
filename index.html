<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #dddddd;
    }

    .card {
      height: 100%;
    }

    .reset-button {
    position: fixed;
    top: 15px;
    right: 15px;
    z-index: 1000;
  }
  
  .chart-container {
    height: 400px;
  }
  
  /* Change to 3-column layout */
  .card-columns {
    column-count: 3;
  }
  </style>
  
  

  <script>
    let chart1, chart2, chart3;
  
    function onClientLoad() {
      gapi.load('client', initClient);
    }
  
    function initClient() {
      gapi.client.init({
        apiKey: 'AIzaSyB2E9qxwpsLkA9CGm-5U65bselwI77dLBA',
        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest']
      }).then(() => {
        document.getElementById('video-form').addEventListener('submit', function(event) {
          event.preventDefault();
  
          const videoId1 = document.getElementById('video-id-1').value;
          const videoId2 = document.getElementById('video-id-2').value;
          const videoId3 = document.getElementById('video-id-3').value;
  
          if (videoId1 && videoId2) {
            compareLiveStreams(videoId1, videoId2, videoId3);
            this.classList.add('d-none');
            document.getElementById('reset-btn').classList.remove('d-none');
          }
        });
      }).catch(error => console.error('Error initializing YouTube Data API:', error));
    }
  
    function resetComparison() {
      clearInterval(updateInterval);
      document.getElementById('video-form').classList.remove('d-none');
      document.getElementById('reset-btn').classList.add('d-none');
      document.getElementById('video-title-1').innerText = 'Video 1 Title';
      document.getElementById('video-title-2').innerText = 'Video 2 Title';
      document.getElementById('video-title-3').innerText = 'Video 3 Title';
      document.getElementById('video-views-1').innerText = '0';
      document.getElementById('video-views-2').innerText = '0';
      document.getElementById('video-views-3').innerText = '0';
      document.getElementById('video-percentage-1').innerText = '0';
      document.getElementById('video-percentage-2').innerText = '0';
      document.getElementById('video-percentage-3').innerText = '0';
      chart1.destroy();
      chart2.destroy();
      chart3.destroy();
      chart1 = null;
      chart2 = null;
      chart3 = null;
    }
  
    let updateInterval;
  
    function compareLiveStreams(videoId1, videoId2, videoId3) {
  if (videoId3) {
    document.getElementById('third-card').style.display = 'block';
  } else {
    document.getElementById('third-card').style.display = 'none';
  }
      updateInterval = setInterval(() => {
        gapi.client.youtube.videos.list({
          id: `${videoId1},${videoId2}${videoId3 ? ',' + videoId3 : ''}`,
          part: 'liveStreamingDetails,snippet,statistics'
        }).then(response => {
          const videos = response.result.items;
  
          const video1 = videos.find(video => video.id === videoId1);
          const video2 = videos.find(video => video.id === videoId2);
          const video3 = videoId3 ? videos.find(video => video.id === videoId3) : null;
  
          const views1 = parseInt(video1.statistics.viewCount, 10);
          const views2 = parseInt(video2.statistics.viewCount, 10);
          const views3 = video3 ? parseInt(video3.statistics.viewCount, 10) : 0;
  
          const totalViews = views1 + views2 + views3;
const percentage1 = ((views1 / totalViews) * 100).toFixed(2);
const percentage2 = ((views2 / totalViews) * 100).toFixed(2);
const percentage3 = video3 ? ((views3 / totalViews) * 100).toFixed(2) : '0';

document.getElementById('video-title-1').innerText = video1.snippet.title;
document.getElementById('video-title-2').innerText = video2.snippet.title;
if (video3) {
  document.getElementById('video-title-3').innerText = video3.snippet.title;
}

document.getElementById('video-views-1').innerText = views1.toLocaleString();
document.getElementById('video-views-2').innerText = views2.toLocaleString();
if (video3) {
  document.getElementById('video-views-3').innerText = views3.toLocaleString();
}

document.getElementById('video-percentage-1').innerText = percentage1;
document.getElementById('video-percentage-2').innerText = percentage2;
if (video3) {
  document.getElementById('video-percentage-3').innerText = percentage3;
}

if (!chart1) {
  const ctx1 = document.getElementById('video-chart-1').getContext('2d');
  chart1 = createPieChart(ctx1, video1.snippet.title, video2.snippet.title, video3 ? video3.snippet.title : null);
}

if (!chart2) {
  const ctx2 = document.getElementById('video-chart-2').getContext('2d');
  chart2 = createPieChart(ctx2, video2.snippet.title, video1.snippet.title, video3 ? video3.snippet.title : null);
}

if (video3 && !chart3) {
  const ctx3 = document.getElementById('video-chart-3').getContext('2d');
  chart3 = createPieChart(ctx3, video3.snippet.title, video1.snippet.title, video2.snippet.title);
}

updatePieChart(chart1, percentage1);
updatePieChart(chart2, percentage2);
if (video3) {
  updatePieChart(chart3, percentage3);
}

}).catch(error => console.error('Error getting video data:', error));
}, 10000);
}

function createPieChart(ctx, videoTitle1, videoTitle2, videoTitle3) {
  const labels = [videoTitle1, videoTitle2];
  const backgroundColors = ['#007bff', '#cccccc'];
  if (videoTitle3) {
    labels.push(videoTitle3);
    backgroundColors.push('#ff9900');
  }

  return new Chart(ctx, {
    type: 'pie',
    data: {
      labels: labels,
      datasets: [{
        data: [0, 100, 0],
        backgroundColor: backgroundColors,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
    }
  });
}

function updatePieChart(chart, percentage) {
  chart.data.datasets[0].data = [percentage, 100 - percentage, 0];
  chart.update();
}
</script>

  
  
</head>
<body onload="onClientLoad()">
    <div class="container">
      <button id="reset-btn" class="btn btn-outline-danger reset-button d-none" onclick="resetComparison()">Reset</button>
  
      <form id="video-form" class="row g-3 mt-3">
        <div class="col-md-4">
          <label for="video-id-1">Stream 1 Video ID:</label>
          <input type="text" class="form-control" id="video-id-1">
        </div>
        <div class="col-md-4">
          <label for="video-id-2">Stream 2 Video ID:</label>
          <input type="text" class="form-control" id="video-id-2">
        </div>
        <div class="col-md-4">
          <label for="video-id-3">Stream 3 Video ID (Optional):</label>
          <input type="text" class="form-control" id="video-id-3">
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-primary mt-1">Compare Streams</button>
        </div>
      </form>
  
      <div class="row mt-5 d-flex align-items-center justify-content-center">
        <div class="col-md-4">
          <div class="card">
            <div class="card-body d-flex flex-column">
              <h4 class="card-title" id="video-title-1">Video 1 Title</h4>
              <h5>Views: <span id="video-views-1">0</span></h5>
              <h5>Percentage: <span id="video-percentage-1">0</span>%</h5>
              <div class="chart-container mt-auto">
                <canvas id="video-chart-1"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card">
            <div class="card-body d-flex flex-column">
              <h4 class="card-title" id="video-title-2">Video 2 Title</h4>
              <h5>Views: <span id="video-views-2">0</span></h5>
              <h5>Percentage: <span id="video-percentage-2">0</span>%</h5>
              <div class="chart-container mt-auto">
                <canvas id="video-chart-2"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4" id="third-card" style="display:none">
          <div class="card">
            <div class="card-body d-flex flex-column">
              <h4 class="card-title" id="video-title-3">Video 3 Title</h4>
              <h5>Views: <span id="video-views-3">0</span></h5>
              <h5>Percentage: <span id="video-percentage-3">0</span>%</h5>
              <div class="chart-container mt-auto">
                <canvas id="video-chart-3"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  
  
</html>

  
